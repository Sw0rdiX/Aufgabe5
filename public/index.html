<!DOCTYPE html>
<html>
<head lang="en">
  <meta charset="UTF-8">
  <title></title>
  <link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
  <style>
    * {
      font-family: 'Roboto', sans-serif;
    }

    h1.center, h2.center, p.center {
      text-align: center;
    }

    label {
      width: 150px;
      display: inline-block;
      padding: 5px;
      margin: 10px;
    }

    input, button {
      width: 200px;
      display: inline-block;
      padding: 5px;
      margin: 5px;
    }

    h5 {
      display: block;
      position: relative;
    }

    h5 > span {
      display: inline-block;
      font-weight: normal;
      position: absolute;
      left: 30vw;
    }

    a {
      color: black;
      text-decoration: none;
    }

    a:hover {
      color: red;
    }

    ul {
      list-style: none;
    }

    ul li a {
      color: black;
      text-decoration: none;
    }

    ul li a:hover {
      color: red;
    }

    ul li {
      padding: 5px;
      margin: 5px;
    }

    #navbar {
      display: block;
      width: 300px;
      position: fixed;
      right: 0;
      top: 3vh;
      background-color: aliceblue;
      z-index: 9999;
    }

  </style>
</head>
<body>
<nav id="navbar" class="fixed">
  <ul><h2>Navbar</h2>
    <li><a href="#Streams/Overview">Streams Overview</a></li>
    <li><a href="#Streams/API">Streams Rest API </a></li>
    <li><a href="#Streams/GET">Streams GET </a></li>
    <li><a href="#Streams/POST">Stream POST </a></li>
    <li><a href="#Events/Overview">Events Overview</a></li>
    <li><a href="#Events/API">Events Rest API</a></li>
    <li><a href="#Events/GET">Events GET</a></li>
    <li><a href="#Events/POST">Event POST</a></li>
  </ul>
</nav>
<h1 class="center">Aufgabe 5 - REST API</h1>

<p class="center">Umsetzung Server mittels NodeJS, Express 4.0, MongoDB, MongooseJS</p>

<h2 class="center" id="Streams/Overview">Streams Overview</h2>
<hr>
<section>
  <h3 id="Streams/API">REST API Streams</h3>

  <h5>POST /api/v1/streams <span>- POST a new Stream to DB</span></h5>

  <h5>GET /api/v1/streams<span>- GET all Streams from DB</span></h5>

  <h5>GET /api/v1/streams/:_id<span>- GET one Stream from DB</span></h5>

  <h5>PUT /api/v1/streams/:_id<span>- UPDATE one Stream to DB</span></h5>

  <h5>DELETE /api/v1/streams/:_id<span>- DELETE one Stream in DB</span></h5>
</section>
<hr>
<section id="getStreams">
  <h3 id="Streams/GET">GET Streams</h3>
  <h4>Size : <span id="streamSize">0</span></h4>
  <h5>GET /api/v1/streams</h5>
  <input id="streamQuery" placeholder="Query like ?name=ServusTV" type="text">
  <button id="searchQuery">Query abschicken</button>
  <ul id="streamList">
    <li>No Streams found...</li>
  </ul>
</section>
<hr>
<section id="postStream">
  <h3 id="Streams/POST">POST Stream</h3>
  <h5>POST /api/v1/streams/<span id="streamIdApi"></span></h5>

  <form action="#getStreams">
    <label for="streamId">ID</label>
    <input id="streamId" type="text" disabled placeholder="Generated by DB">
    <br>
    <label for="streamName">Name <span style="color: red">★</span></label>
    <input id="streamName" type="text" placeholder="Name is required" required="required">
    <br>
    <label for="streamDescription">Description</label>
    <input id="streamDescription" type="text" placeholder="Description is optional">
    <br>
    <label for="streamUrl">Url <span style="color: red">★</span></label>
    <input id="streamUrl" type="text" placeholder="Url is required" required="required">
    <br>
    <label for="streamState">State</label>
    <input id="streamState" type="text" placeholder="State is optional">
    <br>
    <br>
    <input type="reset" value="Zurücksetzen">
    <input type="submit" value="Abschicken">
  </form>
  <br>
  <br>
  <span style="color: red">★</span> <span>are required fields.</span>
</section>
<hr>
<br>

<h2 class="center" id="Events/Overview">Events Overview</h2>
<hr>
<section>
  <h3 id="Events/API">Events REST API</h3>

  <h5>POST /api/v1/events <span>- POST a new Event to DB</span></h5>

  <h5>GET /api/v1/events<span>- GET all Events from DB</span></h5>

  <h5>GET /api/v1/events/:_id<span>- GET one Event from DB</span></h5>

  <h5>PUT /api/v1/events/:_id<span>- UPDATE one Event to DB</span></h5>

  <h5>DELETE /api/v1/events/:_id<span>- DELETE one Event in DB</span></h5>
</section>
<hr>
<section id="getEvents">
  <h3 id="Events/GET">Events GET</h3>
  <h4>Size : <span id="eventSize">0</span></h4>
  <h5>GET /api/v1/events</h5>
  <input id="eventQuery" placeholder="Query like ?name=IFA" type="text">
  <button id="searchEventQuery">Query abschicken</button>
  <ul id="eventList">
    <li>No Events found...</li>
  </ul>
</section>
<hr>
<section id="postEvent">
  <h3 id="Events/POST">POST Event</h3>
  <h5>POST /api/v1/events/<span id="eventIdApi"></span></h5>

  <form action="#getEvents">
    <label for="eventId">ID</label>
    <input id="eventId" type="text" disabled placeholder="Generated by DB">
    <br>
    <label for="eventName">Name <span style="color: red">★</span></label>
    <input id="eventName" type="text" placeholder="Name is required" required="required">
    <br>
    <label for="eventStreams">Streams</label>
    <input id="eventStreams" type="text" placeholder="Streams is optional">
    <br>
    <br>
    <input type="reset" value="Zurücksetzen">
    <input type="submit" value="Abschicken">
  </form>
  <br>
  <br>
  <span style="color: red">★</span> <span>are required fields.</span>
</section>
<hr>
<br>
<hr>
<hr>
<br>
<footer>

  <ul>
    <li><a href="license.html">MIT License</a></li>
  </ul>
</footer>

<script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<script>

  jQuery.get("/api/v1/streams", function (data, textStatus, jqXHR) {
    console.log("Get response:");
    console.dir(data);
    console.log(textStatus);
    console.dir(jqXHR);
    jQuery('#streamSize').html(data.length);
    var streamList = jQuery('#streamList');
    streamList.empty();
    streamList.append('<li><span> NAME </span> (<span> ID </span>)</a></li></li>');
    jQuery.each(data, function (index, value) {
      console.log(index, value);
      console.log(data[index].name);
      streamList.append('<li><a href="details.html?' + data[index]._id + '"><span> ' + data[index].name + '</span> (<span>' + data[index]._id + '</span>)</a></li>');
    })
  });


  jQuery('#postStream').on('submit', function (e) {
    e.preventDefault();
    console.log("POST new Stream...");
    var name = jQuery('#streamName').val();
    var desc = jQuery('#streamDescription').val();
    var url = jQuery('#streamUrl').val();
    var state = jQuery('#streamState').val();
    console.log(name, desc, url, state);

    jQuery.post("/api/v1/streams", {
      "name": name,
      "description": desc,
      "url": url,
      "state": state
    }, function (data, textStatus, jqXHR) {
      console.log("Post response:");
      console.dir(data);
      console.log(textStatus);
      console.dir(jqXHR);
      window.location.reload();
    });
  });


  jQuery('#searchQuery').on('click', function (e) {

    var query = jQuery('#streamQuery').val();
    console.log(query);
    jQuery.get("/api/v1/streams?" + query, function (data, textStatus, jqXHR) {
      console.log("Get response:");
      console.dir(data);
      console.log(textStatus);
      console.dir(jqXHR);
      jQuery('#streamSize').html(data.length);
      var streamList = jQuery('#streamList');
      streamList.empty();
      streamList.append('<li><span> NAME </span> (<span> ID </span>)</a></li></li>');
      jQuery.each(data, function (index, value) {
        console.log(index, value);
        console.log(data[index].name);
        streamList.append('<li><a href="details.html?' + data[index]._id + '"><span> ' + data[index].name + '</span> (<span>' + data[index]._id + '</span>)</a></li>');
      })
    });
  });


  jQuery.get("/api/v1/events", function (data, textStatus, jqXHR) {
    console.log("Get response:");
    console.dir(data);
    console.log(textStatus);
    console.dir(jqXHR);
    jQuery('#eventSize').html(data.length);
    var eventList = jQuery('#eventList');
    eventList.empty();
    eventList.append('<li><span> NAME </span> (<span> ID </span>)</a></li></li>');
    jQuery.each(data, function (index, value) {
      console.log(index, value);
      console.log(data[index].name);
      eventList.append('<li><a href="details.html?' + data[index]._id + '"><span> ' + data[index].name + '</span> (<span>' + data[index]._id + '</span>)</a></li>');
    })
  });

  jQuery('#postEvent').on('submit', function (e) {
    e.preventDefault();
    console.log("POST new Event...");
    var name = jQuery('#eventName').val();
    var streams = jQuery('#eventStreams').val();
    console.log(name, streams);

    jQuery.post("/api/v1/events", {
      "name": name,
      "streams": streams
    }, function (data, textStatus, jqXHR) {
      console.log("Post response:");
      console.dir(data);
      console.log(textStatus);
      console.dir(jqXHR);
      window.location.reload();
    });
  });
</script>

</body>
</html>